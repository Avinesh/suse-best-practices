<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" type="xml"?>
<!DOCTYPE article [
<!ENTITY % entity SYSTEM "entity-decl.ent">
%entity;
]>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="art.sbp.suma.rhconnect"
    xml:lang="en">
    <info>
        <title>How to Directly Connect SUSE Manager to Red Hat Content Delivery Network</title>
        <subtitle>Methods to receive your Red Hat updates and patches</subtitle>
        <orgname>SUSE Best Practices</orgname>
        <productname>SUSE Manager</productname>
        <productnumber>2.1</productnumber>
        <author>
            <personname>
                <firstname>Cameron</firstname>
                <surname>Seader</surname>
            </personname>
            <affiliation>
                <jobtitle>Sales Engineer</jobtitle>
                <orgname>&suse;</orgname>
            </affiliation>
        </author>

        <abstract>
            <para>The described solution allows you to directly connect SUSE Manager to the Red Hat
                Content Delivery Network to retrieve your software updates and patches. This is
                useful if you <itemizedlist>
                    <listitem>
                        <para>plan on continuing your agreement with Red Hat</para>
                    </listitem>
                    <listitem>
                        <para>don't want to use Expanded Support from SUSE</para>
                    </listitem>
                    <listitem>
                        <para>have multiple distributions that you want to update and patch from
                            SUSE Manager</para>
                    </listitem>
                    <listitem>
                        <para>use an updated code stream of the Satellite 5 series, and continue
                            your use of an enhanced road map to the Spacewalk project</para>
                    </listitem>
                </itemizedlist>
            </para>

            <para>You must have a current subscription with Red Hat. This in no way requires that
                you have a subscription to Satellite Server from Red Hat.</para>
        </abstract>
    </info>


    <sect1 xml:id="sec.importrhcert">
        <title>Import Red Hat Entitlement and CA Certificate</title>

        <para>During the next few paragraphs, you will learn how to import the Red Hat CA and
            entitlement certificate.</para>

        <sect2 xml:id="sec.entitlecert">
            <title>Entitlement Certificate</title>
            <para>In a first step, you need to do download the manifest file from Red Hat. To
                achieve this just follow the documentation from Red Hat which is posted here:</para>
            <para> Managing On-Premise Subscription Management Applications <link
                    xlink:href="https://access.redhat.com/documentation/en-US/Red_Hat_Customer_Portal/1/html/Red_Hat_Network_Certificate-based_Subscription_Management/managing-sam.html"
                />
            </para>
            <para> How to get a Subscription Manifest for Subscription Asset Manager or Satellite 6
                    <link xlink:href="https://access.redhat.com/solutions/118573"/>
            </para>

            <para>The documentation will show you how to set up an organization in the Red Hat
                Portal and download your manifest file via the Red Hat Customer Portal. The manifest
                file also includes an entitlement SSL certificate that will be used later for
                authentication to the Content Delivery Network. </para>

            <figure>
                <title>Red Hat Customer Portal, Subscription Management</title>
                <mediaobject>
                    <imageobject role="fo">
                        <imagedata fileref="suma-connect-rhportal.png" width="95%" format="PNG"/>
                    </imageobject>
                    <imageobject role="html">
                        <imagedata fileref="suma-connect-rhportal.png" width="90%" format="PNG"/>
                    </imageobject>
                </mediaobject>
            </figure>

            <para>Download the manifest file and choose "Save File" when prompted.</para>

            <figure>
                <title>Download and Save Manifest File</title>
                <mediaobject>
                    <imageobject role="fo">
                        <imagedata fileref="suma-connect-rhmanifest.png" width="95%" format="PNG"/>
                    </imageobject>
                    <imageobject role="html">
                        <imagedata fileref="suma-connect-rhmanifest.png" width="90%" format="PNG"/>
                    </imageobject>
                </mediaobject>
            </figure>

            <para>The file name will look similar to the below. </para>

            <para>
                <filename>manifest_182cddfa-c49b-xxxx-xxxx-20f1a061f2d4.zip</filename>
            </para>

            <para>The Universally Unique Identifier (UUID) at the end of the file name will be
                different for every customer. Unzip the manifest file which will reveal another zip
                archive that looks like this:</para>

            <para>
                <literallayout> 
                    > unzip manifest_182cddfa-c49b-xxxx-xxxx-20f1a061f2d4.zip 
                    Archive: manifest_182cddfa-c49b-xxxx-xxxx-20f1a061f2d4.zip 
                    signed Candlepin export for 182cddfa-c49b-xxxx-xxxx-20f1a061f2d4 
                    inflating: consumer_export.zip inflating: signature 
                </literallayout>
            </para>

            <para>Now unzip the consumer_export.zip file.</para>

            <para>
                <literallayout> 
                    > unzip consumer_export.zip 
                    Archive: consumer_export.zip 
                    Candlepin export for 182cddfa-c49b-xxxx-xxxx-20f1a061f2d4 
                    inflating: export/entitlement_certificates/3277872547XXXX51225.pem 
                    ... 
                    inflating: export/products/293.json 
                    ... 
                    inflating: export/upstream_consumer/5830337363XXXX10347.json 
                    inflating: export/rules2/rules.js inflating: export/distributor_version/sam-1.4.json 
                    ...
                    inflating: export/consumer_types/system.json 
                    ... 
                    inflating: export/rules/default-rules.js 
                    inflating: export/entitlements/8a85f98951b0a3fb0151b63xxxx06c2a.json 
                </literallayout>
            </para>

            <para>The size of the output has been reduced here, but you can clearly see this archive
                contains quite a few components. The only components we care about are what is
                listed under export/entitlement_certificates/. As you can see from the output above,
                the file under /export/entitlement_certificates is a .pem file with a long number.
                This file is used as both the SSL Client Certificate and SSL Client Key when you
                import it into SUSE Manager. For now just copy this file to another location of your
                choosing. It will be referenced later. </para>

        </sect2>

        <sect2 xml:id="sec.rhcacert">
            <title>Red Hat CA Certificate</title>

            <para>The next step is to get the Red Hat CA Certificate file. There might be multiple
                locations for this file, but the one place you can find them for sure is on the
                GitHub pages for the Katello project which is used in product Red Hat Satellite 6.
                So its not surprising that its out there since you can use Katello standalone to
                connect to the Red Hat CDN. You can find the link here: </para>

            <para>
                <link xlink:href="https://github.com/Katello/katello/blob/master/ca/redhat-uep.pem"
                />
            </para>

            <note>
                <title>Additional source for Red Hat CA Certificate files</title>
                <para> Another way to get this file is from the Red Hat Subscription Management
                    product. Once it is installed the file is located at
                    /etc/rhsm/ca/redhat-uep.pem</para>
            </note>

            <para>Save the file in raw format to your local system. Just like in the screen shot
                below, right click the <emphasis role="bold">Raw</emphasis> button.</para>

            <figure>
                <title>Download Red Hat CA Certificate file</title>
                <mediaobject>
                    <imageobject role="fo">
                        <imagedata fileref="suma-connect-getrhcerts.png" width="95%" format="PNG"/>
                    </imageobject>
                    <imageobject role="html">
                        <imagedata fileref="suma-connect-getrhcerts.png" width="90%" format="PNG"/>
                    </imageobject>
                </mediaobject>
            </figure>

            <para>After that, click <emphasis role="bold">save link as</emphasis> or use a similar
                method to save the file depending on your desktop environment. Save the file as
                    <filename>redhat-uep.pem</filename> and put it in the same location where you
                put the entitlement certificate from <xref linkend="sec.entitlecert"/>. We will
                reference it in <xref linkend="sec.import"/>.</para>

        </sect2>

        <sect2 xml:id="sec.import">
            <title>Import</title>

            <para>Now you are ready to import the Red Hat CA Certificate and Entitlement Certificate
                into SUSE Manager for software repository mirroring. </para>

            <para>Start your SUSE Manager. Go to the <emphasis role="bold">Systems</emphasis> tab at
                the top. Click on <emphasis>Autoinstallation</emphasis> on the left Pane, and then
                click on <emphasis>GPG and SSL Keys</emphasis> also on the left pane, as you can see
                it from the screenshot below.</para>

            <figure>
                <title>SUSE Manager GPG Public Keys and SSL Certificates</title>
                <mediaobject>
                    <imageobject role="fo">
                        <imagedata fileref="suma-connect-rhcertimport.png" width="95%" format="PNG"
                        />
                    </imageobject>
                    <imageobject role="html">
                        <imagedata fileref="suma-connect-rhcertimport.png" width="90%" format="PNG"
                        />
                    </imageobject>
                </mediaobject>
            </figure>

            <para>Click on <emphasis role="bold">Create Stored Key/Cert</emphasis> on the right.
                Another screen opens where you can fill in the required information.</para>

            <figure>
                <title>SUSE Manager Create GPG/SSL Keys</title>
                <mediaobject>
                    <imageobject role="fo">
                        <imagedata fileref="suma-connect-createkey.png" width="95%" format="PNG"/>
                    </imageobject>
                    <imageobject role="html">
                        <imagedata fileref="suma-connect-createkey.png" width="90%" format="PNG"/>
                    </imageobject>
                </mediaobject>
            </figure>

            <para>Enter the following values:</para>
            <literallayout>
                    Description: Entitlement-Cert
                    Type: SSL
                    Select file to upload: Browse to the locationwhere you saved the Entitlement Certificate and select it  
                </literallayout>

            <para>Click the <emphasis role="bold">Create Key</emphasis> button at the bottom.</para>


            <figure>
                <title>SUSE Manager Create Key Button</title>
                <mediaobject>
                    <imageobject role="fo">
                        <imagedata fileref="suma-connect-buttoncreatekey.png" width="95%"
                            format="PNG"/>
                    </imageobject>
                    <imageobject role="html">
                        <imagedata fileref="suma-connect-buttoncreatekey.png" width="90%"
                            format="PNG"/>
                    </imageobject>
                </mediaobject>
            </figure>

            <para>Repeat the above steps for the Red Hat CA Certificate (redhat-uep) and change the
                values to match the following:</para>

            <literallayout>
                Description: redhat-uep
                Type: SSL
                Select file to upload: Browse to the location where you saved the Red Hat CA Certificate and select it.
            </literallayout>

            <para>You now have imported both the Red Hat CA and Entitlement Certificate into SUSE
                Manager for use and your outcome should look like the screen below:</para>

            <figure>
                <title>SUSE Manager Imported Red Hat Certificates</title>
                <mediaobject>
                    <imageobject role="fo">
                        <imagedata fileref="suma-connect-sumarhcert.png" width="95%" format="PNG"/>
                    </imageobject>
                    <imageobject role="html">
                        <imagedata fileref="suma-connect-sumarhcert.png" width="90%" format="PNG"/>
                    </imageobject>
                </mediaobject>
            </figure>

        </sect2>

    </sect1>

    <sect1>
        <title>Create Software Repositories</title>

        <para>In order to mirror the software from the Red Hat CDN, you need to create some
            repositories in SUSE Manager that are linked to the CDN with their respective URL. This
            will only work if you have entitlements to these products in your Red Hat Portal. To
            create these software repositories you need to perform the following actions. </para>

        <para>On your SUSE Manager screen, go to the <emphasis role="bold">Channels</emphasis> tab
            at top. Click on <emphasis role="bold">Manage Software Channels</emphasis> on the left
            pane, and then click on <emphasis role="">Manage Repositories</emphasis> also on the
            left pane.</para>

        <figure>
            <title>SUSE Manager Repositories</title>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="suma-connect-sumarepo.png" width="95%" format="PNG"/>
                </imageobject>
                <imageobject role="html">
                    <imagedata fileref="suma-connect-sumarepo.png" width="90%" format="PNG"/>
                </imageobject>
            </mediaobject>
        </figure>

        <para>Click on <emphasis role="bold">Create Repository</emphasis>. The following screen
            opens, where you can enter the required information to create the repository.</para>

        <figure>
            <title>SUSE Manager Create Repository</title>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="suma-connect-sumacreaterepo.png" width="95%" format="PNG"/>
                </imageobject>
                <imageobject role="html">
                    <imagedata fileref="suma-connect-sumacreaterepo.png" width="90%" format="PNG"/>
                </imageobject>
            </mediaobject>
        </figure>

        <para>Fill in the fields with values.</para>

        <note>
            <title> Double Use of Entitlement-Cert</title>
            <para>Entitlement-Cert is used twice for SSL Client Certificate and SSL Client Key. This
                is the certificate file you imported in one of the previous steps along with the
                redhat-uep for the SSL CA Certificate. </para>
        </note>

        <para>Example for the values:
            <literallayout>
            Repository Label: rhel-7-server-rpms
            Repository URL: https://cdn.redhat.com/content/dist/rhel/server/7/7Server/x86_64/os/
            Has Signed Metadata?: Uncheck (Uncheck for all Red Hat Enterprise Repositories)
            SSL CA Certificate: redhat-uep
            SSL Client Certificate: Entitlement-Cert
            SSL Client Key: Entitlement-Cert
        </literallayout>
        </para>

        <para>These steps will need to be repeated for the Products / Repository URL's you will be
            defining for your environment. Use the values from the next section to create all
            required repositories. </para>



    </sect1>

</article>
